{"version":3,"sources":["../../../src/workers/transpiler/index.test.js"],"names":[],"mappings":"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","file":"index.test.js","sourcesContent":["import {expect} from 'chai'\nimport {fromJS} from 'immutable'\nimport {GOAL_TRANSPILE} from 'state/foreman'\nimport {inProgress} from 'workers/transpiler/state'\nimport {mockStore} from 'utils/test'\nimport {workerBusy, workerReady, WORKER_TRANSPILER} from 'state/workers'\nimport proxyquire from 'proxyquire'\nimport sinon from 'sinon'\n\ndescribe('workers/transpiler', () => {\n  const dispatchSpy = sinon.spy()\n  const globStub = sinon.stub().returns(['src/spike.js', 'src/lee.js'])\n  const subscribeSpy = sinon.spy()\n  const transpileSpy = sinon.spy()\n\n  const transpiler = proxyquire('./index', {\n    'glob': {sync: globStub},\n    'state/store': {getStore: () => ({\n      dispatch: dispatchSpy,\n      subscribe: subscribeSpy,\n    })},\n    'utils/babel': {transpileToDir: transpileSpy},\n  })\n\n  afterEach(() => {\n    dispatchSpy.reset()\n    globStub.reset()\n    subscribeSpy.reset()\n    transpileSpy.reset()\n    process.on.reset()\n    process.send.reset()\n  })\n\n  describe('init', () => {\n\n    it('subscribes to state changes', () => {\n      transpiler.init()\n      expect(subscribeSpy).to.have.been.calledOnceÃŽ\n    })\n\n    it('dispatches actions from parent process messages', () => {\n      const message = 'Test message'\n\n      transpiler.init()\n\n      expect(process.on).to.have.been.calledOnce\n\n      const callback = process.on.firstCall.args[1]\n      callback(message)\n\n      expect(dispatchSpy).to.have.been.calledWith(message)\n    })\n\n    it('sends a ready message back to the parent process', () => {\n      transpiler.init()\n      expect(process.send).to.have.been.calledWith(workerReady(WORKER_TRANSPILER))\n    })\n\n  })\n\n  describe('transpile()', () => {\n\n    it('reports status to the worker and updates internal status', done => {\n      const expectedActions = [inProgress(true), inProgress(false)]\n      const store = mockStore({}, expectedActions, done)\n\n      transpiler.transpile(store)\n\n      expect(process.send).to.have.been.calledWith(workerBusy(WORKER_TRANSPILER))\n      expect(process.send).to.have.been.calledWith(workerReady(WORKER_TRANSPILER))\n    })\n\n    it('calls transpileToDir with the appropriate arguments', done => {\n      const expectedActions = [inProgress(true), inProgress(false)]\n      const store = mockStore({}, expectedActions, done)\n\n      transpiler.transpile(store)\n\n      expect(transpileSpy).to.have.been.calledWith({\n        baseDir: 'src',\n        filenames: ['src/spike.js', 'src/lee.js'],\n        outDir: 'build',\n        sourceMaps: true,\n      })\n    })\n\n  })\n\n  describe('stateChanged()', () => {\n\n    describe('GOAL_TRANSPILE', () => {\n\n      it('runs a transpile', () => {\n        const store = {\n          dispatch: () => {},\n          getState: () => ({\n            transpiler: fromJS({goal: GOAL_TRANSPILE, inProgress: false}),\n          }),\n        }\n\n        transpiler.stateChanged(store)\n\n        expect(transpileSpy).to.have.been.calledOnce\n      })\n\n    })\n\n  })\n\n})\n"]}